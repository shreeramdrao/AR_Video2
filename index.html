<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR Reel Video</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@google/model-viewer@latest"></script>
</head>
<body style="margin: 0; overflow: hidden;">

    <button id="startAR" style="
        position: absolute; 
        top: 50%; 
        left: 50%; 
        transform: translate(-50%, -50%);
        padding: 15px 25px; 
        font-size: 18px; 
        background: #007bff; 
        color: white; 
        border: none; 
        border-radius: 8px; 
        cursor: pointer;
        z-index: 10;">
        Start AR Video
    </button>

    <script>
        let scene, camera, renderer, videoTexture, videoScreen;
        
        async function startAR() {
            if (!navigator.xr) {
                alert("WebXR not supported on this device/browser.");
                return;
            }

            try {
                const session = await navigator.xr.requestSession('immersive-ar', {
                    requiredFeatures: ['local-floor']
                });
                
                setupScene();
                renderer.xr.setSession(session);

                session.requestReferenceSpace('local-floor').then(referenceSpace => {
                    renderer.xr.setReferenceSpace(referenceSpace);
                });
            } catch (err) {
                console.error('WebXR session failed:', err);
                alert("AR Session failed: " + err.message);
            }
        }

        function setupScene() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            scene.add(camera);
            renderer = new THREE.WebGLRenderer({ alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.xr.enabled = true;
            document.body.appendChild(renderer.domElement);
            
            const light = new THREE.HemisphereLight(0xffffff, 0xbbbbff, 1);
            scene.add(light);
            
            const video = document.createElement('video');
            video.src = 'https://ar-video2.vercel.app/assets/videoplayback.mp4';
            video.loop = true;
            video.muted = false;
            video.autoplay = true;
            video.play().catch(e => console.error("Video play failed", e));
            
            videoTexture = new THREE.VideoTexture(video);
            videoTexture.minFilter = THREE.LinearFilter;
            videoTexture.magFilter = THREE.LinearFilter;
            
            const geometry = new THREE.PlaneGeometry(0.9, 1.6);
            const material = new THREE.MeshBasicMaterial({ map: videoTexture });
            videoScreen = new THREE.Mesh(geometry, material);
            videoScreen.position.set(0, 1, -2);
            scene.add(videoScreen);
            
            setupControls();
            
            function animate() {
                renderer.setAnimationLoop(() => {
                    renderer.render(scene, camera);
                });
            }
            animate();
        }

        function setupControls() {
            let isDragging = false, lastX = 0, lastY = 0;
            let lastDistance = null;

            window.addEventListener('wheel', (event) => {
                videoScreen.position.z += event.deltaY * 0.005;
            });
            
            window.addEventListener('touchstart', (event) => {
                if (event.touches.length === 2) {
                    lastDistance = getTouchDistance(event.touches);
                } else if (event.touches.length === 1) {
                    isDragging = true;
                    lastX = event.touches[0].clientX;
                    lastY = event.touches[0].clientY;
                }
            });
            
            window.addEventListener('touchmove', (event) => {
                if (event.touches.length === 2 && lastDistance !== null) {
                    let newDistance = getTouchDistance(event.touches);
                    videoScreen.position.z *= lastDistance / newDistance;
                    lastDistance = newDistance;
                } else if (event.touches.length === 1 && isDragging) {
                    let deltaX = (event.touches[0].clientX - lastX) * 0.01;
                    let deltaY = (event.touches[0].clientY - lastY) * -0.01;
                    videoScreen.position.x += deltaX;
                    videoScreen.position.y += deltaY;
                    lastX = event.touches[0].clientX;
                    lastY = event.touches[0].clientY;
                }
            });
            
            window.addEventListener('touchend', () => {
                lastDistance = null;
                isDragging = false;
            });
            
            window.addEventListener('mousedown', (event) => {
                isDragging = true;
                lastX = event.clientX;
                lastY = event.clientY;
            });
            
            window.addEventListener('mousemove', (event) => {
                if (isDragging) {
                    let deltaX = (event.clientX - lastX) * 0.01;
                    let deltaY = (event.clientY - lastY) * -0.01;
                    videoScreen.position.x += deltaX;
                    videoScreen.position.y += deltaY;
                    lastX = event.clientX;
                    lastY = event.clientY;
                }
            });
            
            window.addEventListener('mouseup', () => {
                isDragging = false;
            });
        }

        function getTouchDistance(touches) {
            let dx = touches[0].pageX - touches[1].pageX;
            let dy = touches[0].pageY - touches[1].pageY;
            return Math.sqrt(dx * dx + dy * dy);
        }

        document.getElementById('startAR').addEventListener('click', function() {
            this.style.display = 'none';
            startAR();
        });
    </script>
</body>
</html>
